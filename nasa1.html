<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA Bioscience Research Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        body { 
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 25%, #0f1828 50%, #1e2538 75%, #0a0e27 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .tab-content { display: none; animation: fadeInUp 0.5s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stat-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
        .stat-card::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            opacity: 0; transition: opacity 0.4s ease;
        }
        .stat-card:hover::before { opacity: 1; }
        .stat-card:hover { transform: translateY(-12px) scale(1.02); box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .publication-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 2px solid transparent; }
        .publication-card:hover { box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4); transform: translateY(-5px); border-color: #3B82F6; }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #1f2937; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .tab-btn { position: relative; overflow: hidden; }
        .tab-btn::after {
            content: ''; position: absolute; bottom: 0; left: 50%; width: 0; height: 3px;
            background: linear-gradient(90deg, #3B82F6, #8B5CF6); transition: all 0.3s ease; transform: translateX(-50%);
        }
        .tab-btn.active::after { width: 100%; }
        #network-graph { width: 100%; height: 600px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 16px; }
        .glow-text { text-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
        .glass-card { background: rgba(31, 41, 55, 0.4); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body class="text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <header class="text-center mb-12 relative">
            <div class="inline-block">
                <h1 class="text-5xl md:text-6xl lg:text-7xl font-extrabold mb-4 bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent glow-text">
                    NASA Bioscience Research Explorer
                </h1>
                <div class="h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-full animate-pulse-slow"></div>
            </div>
            <p class="text-gray-300 text-xl md:text-2xl mb-2 mt-6">Intelligent Dashboard for Space Biology Research</p>
            <p class="text-gray-400 text-sm">Analyzing 1,000+ Publications</p>
        </header>

        <nav class="flex flex-wrap justify-center gap-3 mb-12">
            <button onclick="showTab('overview')" class="tab-btn active px-6 py-3 bg-gray-800/60 hover:bg-gray-700/60 rounded-xl font-semibold transition-all duration-300 shadow-lg glass-card">Overview</button>
            <button onclick="showTab('search')" class="tab-btn px-6 py-3 bg-gray-800/60 hover:bg-gray-700/60 rounded-xl font-semibold transition-all duration-300 glass-card">Search</button>
            <button onclick="showTab('insights')" class="tab-btn px-6 py-3 bg-gray-800/60 hover:bg-gray-700/60 rounded-xl font-semibold transition-all duration-300 glass-card">Insights</button>
            <button onclick="showTab('knowledge-graph')" class="tab-btn px-6 py-3 bg-gray-800/60 hover:bg-gray-700/60 rounded-xl font-semibold transition-all duration-300 glass-card">Graph</button>
            <button onclick="showTab('audience')" class="tab-btn px-6 py-3 bg-gray-800/60 hover:bg-gray-700/60 rounded-xl font-semibold transition-all duration-300 glass-card">Audience</button>
        </nav>

        <section id="overview" class="tab-content active">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="stat-card bg-gradient-to-br from-blue-600/30 to-blue-800/30 rounded-2xl p-6 shadow-2xl border border-blue-500/30 glass-card">
                    <h3 class="text-blue-300 text-sm font-medium mb-2 uppercase tracking-wide">Total Publications</h3>
                    <p class="text-5xl font-bold text-white mb-1">1,000</p>
                    <p class="text-blue-200 text-xs">Across all areas</p>
                </div>
                <div class="stat-card bg-gradient-to-br from-green-600/30 to-green-800/30 rounded-2xl p-6 shadow-2xl border border-green-500/30 glass-card">
                    <h3 class="text-green-300 text-sm font-medium mb-2 uppercase tracking-wide">Organisms</h3>
                    <p class="text-5xl font-bold text-white mb-1">4</p>
                    <p class="text-green-200 text-xs">Model organisms</p>
                </div>
                <div class="stat-card bg-gradient-to-br from-purple-600/30 to-purple-800/30 rounded-2xl p-6 shadow-2xl border border-purple-500/30 glass-card">
                    <h3 class="text-purple-300 text-sm font-medium mb-2 uppercase tracking-wide">Research Areas</h3>
                    <p class="text-5xl font-bold text-white mb-1">5</p>
                    <p class="text-purple-200 text-xs">Key focus areas</p>
                </div>
                <div class="stat-card bg-gradient-to-br from-orange-600/30 to-orange-800/30 rounded-2xl p-6 shadow-2xl border border-orange-500/30 glass-card">
                    <h3 class="text-orange-300 text-sm font-medium mb-2 uppercase tracking-wide">Year Span</h3>
                    <p class="text-5xl font-bold text-white mb-1">20+</p>
                    <p class="text-orange-200 text-xs">2005-2025</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-gray-700/50">
                    <h3 class="text-2xl font-bold mb-6 text-blue-400">Publications Timeline</h3>
                    <canvas id="yearChart" class="h-80"></canvas>
                </div>
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-gray-700/50">
                    <h3 class="text-2xl font-bold mb-6 text-green-400">Organisms</h3>
                    <canvas id="organismChart" class="h-80"></canvas>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-gray-700/50">
                    <h3 class="text-2xl font-bold mb-6 text-purple-400">Research Areas</h3>
                    <canvas id="researchAreaChart" class="h-80"></canvas>
                </div>
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-gray-700/50">
                    <h3 class="text-2xl font-bold mb-6 text-orange-400">Space Conditions</h3>
                    <canvas id="conditionChart" class="h-80"></canvas>
                </div>
            </div>
        </section>

        <section id="search" class="tab-content">
            <div class="mb-8">
                <input type="text" id="searchInput" placeholder="Search publications..." class="w-full px-6 py-4 glass-card border-2 border-gray-600/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 transition-all duration-300 shadow-lg" oninput="filterPubs()">
            </div>
            <div class="glass-card rounded-xl p-6 mb-8 border border-gray-700 shadow-lg">
                <h3 class="text-xl font-bold mb-4 text-white">Filters</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-400 text-sm mb-2 font-medium">Organism</label>
                        <select id="orgFilter" onchange="filterPubs()" class="w-full px-4 py-3 glass-card border border-gray-600 rounded-lg text-white focus:border-blue-500 focus:outline-none transition-all">
                            <option value="">All</option>
                            <option value="Human">Human</option>
                            <option value="Mouse">Mouse</option>
                            <option value="Yeast">Yeast</option>
                            <option value="Plant">Plant</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-2 font-medium">Area</label>
                        <select id="areaFilter" onchange="filterPubs()" class="w-full px-4 py-3 glass-card border border-gray-600 rounded-lg text-white focus:border-blue-500 focus:outline-none transition-all">
                            <option value="">All</option>
                            <option value="Gene Expression">Gene Expression</option>
                            <option value="Bone Health">Bone Health</option>
                            <option value="Muscle Atrophy">Muscle Atrophy</option>
                            <option value="Radiation Effects">Radiation Effects</option>
                            <option value="Immune Response">Immune Response</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-2 font-medium">Year</label>
                        <select id="yearFilter" onchange="filterPubs()" class="w-full px-4 py-3 glass-card border border-gray-600 rounded-lg text-white focus:border-blue-500 focus:outline-none transition-all">
                            <option value="">All</option>
                            <option value="recent">Last 5 Years</option>
                            <option value="2015-2020">2015-2020</option>
                            <option value="2010-2015">2010-2015</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-white">Publications</h2>
                <p class="text-gray-400 mt-1" id="resultCount">100 publications</p>
            </div>
            <div id="pubsList" class="space-y-6 max-h-[600px] overflow-y-auto pr-2 scrollbar-thin"></div>
            <div class="text-center mt-8">
                <button onclick="loadMore()" id="loadBtn" class="px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 rounded-xl font-semibold transition-all duration-300 shadow-xl transform hover:scale-105">Load More</button>
            </div>
        </section>

        <section id="insights" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-gray-700/50">
                    <h3 class="text-2xl font-bold mb-4 text-yellow-400">Knowledge Gaps</h3>
                    <p class="text-gray-400 mb-4">Underrepresented areas</p>
                    <div class="space-y-3 max-h-80 overflow-y-auto scrollbar-thin" id="gaps"></div>
                </div>
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-gray-700/50">
                    <h3 class="text-2xl font-bold mb-4 text-green-400">Consensus Areas</h3>
                    <p class="text-gray-400 mb-4">Well-established research</p>
                    <div class="space-y-3 max-h-80 overflow-y-auto scrollbar-thin" id="consensus"></div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-gray-700/50">
                    <h3 class="text-2xl font-bold mb-4 text-blue-400">Recent Trends</h3>
                    <p class="text-gray-400 mb-4">Emerging areas</p>
                    <div class="space-y-3" id="trends"></div>
                </div>
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-gray-700/50">
                    <h3 class="text-2xl font-bold mb-4 text-purple-400">Research Maturity</h3>
                    <canvas id="stageChart" class="h-64 mb-4"></canvas>
                    <div class="space-y-2" id="stageInfo"></div>
                </div>
            </div>
            <section class="glass-card rounded-2xl p-8 shadow-2xl border border-blue-700/30">
                <h3 class="text-3xl font-bold mb-8 text-white text-center">Actionable Insights</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-br from-blue-600/20 to-blue-800/20 rounded-xl p-6 border border-blue-500/30">
                        <h4 class="text-xl font-bold mb-4 text-blue-400">Scientists</h4>
                        <ul class="space-y-3 text-gray-300 text-sm">
                            <li>400 high-relevance publications</li>
                            <li>10 underexplored combinations</li>
                            <li>Strong gene expression foundation</li>
                        </ul>
                    </div>
                    <div class="bg-gradient-to-br from-purple-600/20 to-purple-800/20 rounded-xl p-6 border border-purple-500/30">
                        <h4 class="text-xl font-bold mb-4 text-purple-400">Managers</h4>
                        <ul class="space-y-3 text-gray-300 text-sm">
                            <li>350 high-impact publications</li>
                            <li>10 funding opportunities</li>
                            <li>5 mature research areas</li>
                        </ul>
                    </div>
                    <div class="bg-gradient-to-br from-orange-600/20 to-orange-800/20 rounded-xl p-6 border border-orange-500/30">
                        <h4 class="text-xl font-bold mb-4 text-orange-400">Mission Planners</h4>
                        <ul class="space-y-3 text-gray-300 text-sm">
                            <li>450 mission-critical publications</li>
                            <li>Focus: bone, muscle, radiation</li>
                            <li>ISS data for Moon/Mars missions</li>
                        </ul>
                    </div>
                </div>
            </section>
        </section>

        <section id="knowledge-graph" class="tab-content">
            <div class="glass-card rounded-xl p-6 shadow-2xl border border-gray-700/50 mb-6">
                <h3 class="text-2xl font-bold mb-4 text-purple-400">Research Network</h3>
                <p class="text-gray-400 mb-2">Interactive connections between research elements</p>
                <p class="text-gray-500 text-sm">Drag nodes to explore relationships</p>
            </div>
            <div class="glass-card rounded-xl p-6 shadow-2xl border border-gray-700/50 mb-6">
                <div id="network-graph"></div>
            </div>
            <div class="glass-card rounded-xl p-6 shadow-2xl border border-gray-700/50">
                <h4 class="font-bold mb-4 text-white text-lg">Legend</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full bg-blue-500 shadow-lg"></div><span class="text-gray-300">Organisms</span></div>
                    <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full bg-purple-500 shadow-lg"></div><span class="text-gray-300">Areas</span></div>
                    <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full bg-green-500 shadow-lg"></div><span class="text-gray-300">Conditions</span></div>
                    <div class="flex items-center gap-3"><div class="w-5 h-0.5 bg-gray-400"></div><span class="text-gray-300">Links</span></div>
                </div>
            </div>
        </section>

        <section id="audience" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-blue-500/30 bg-gradient-to-br from-blue-600/20 to-blue-800/20">
                    <h3 class="text-2xl font-bold mb-4 text-white">Scientists</h3>
                    <p class="text-blue-200 mb-6 text-sm">Hypothesis & mechanisms</p>
                    <div class="bg-blue-950/50 rounded-xl p-5 mb-4 text-center border border-blue-500/20">
                        <p class="text-5xl font-bold text-white mb-2">400</p>
                        <p class="text-blue-200 text-sm">High Relevance</p>
                    </div>
                    <button onclick="filterAud('scientist')" class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 rounded-xl font-semibold transition-all duration-300 mb-6 shadow-lg transform hover:scale-105">View</button>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between p-2 bg-blue-950/30 rounded-lg"><span class="text-blue-300">Gene Expression</span><span class="text-white font-bold">250</span></div>
                        <div class="flex justify-between p-2 bg-blue-950/30 rounded-lg"><span class="text-blue-300">Immune Response</span><span class="text-white font-bold">220</span></div>
                    </div>
                </div>
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-purple-500/30 bg-gradient-to-br from-purple-600/20 to-purple-800/20">
                    <h3 class="text-2xl font-bold mb-4 text-white">Managers</h3>
                    <p class="text-purple-200 mb-6 text-sm">Investment & portfolio</p>
                    <div class="bg-purple-950/50 rounded-xl p-5 mb-4 text-center border border-purple-500/20">
                        <p class="text-5xl font-bold text-white mb-2">350</p>
                        <p class="text-purple-200 text-sm">High Impact</p>
                    </div>
                    <button onclick="filterAud('manager')" class="w-full px-4 py-3 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 rounded-xl font-semibold transition-all duration-300 mb-6 shadow-lg transform hover:scale-105">View</button>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between p-2 bg-purple-950/30 rounded-lg"><span class="text-purple-300">Gap 1</span><span class="text-yellow-400 font-bold">2</span></div>
                        <div class="flex justify-between p-2 bg-purple-950/30 rounded-lg"><span class="text-purple-300">Gap 2</span><span class="text-yellow-400 font-bold">3</span></div>
                    </div>
                </div>
                <div class="glass-card rounded-2xl p-6 shadow-2xl border border-orange-500/30 bg-gradient-to-br from-orange-600/20 to-orange-800/20">
                    <h3 class="text-2xl font-bold mb-4 text-white">Mission Planners</h3>
                    <p class="text-orange-200 mb-6 text-sm">Health & safety</p>
                    <div class="bg-orange-950/50 rounded-xl p-5 mb-4 text-center border border-orange-500/20">
                        <p class="text-5xl font-bold text-white mb-2">450</p>
                        <p class="text-orange-200 text-sm">Mission-Critical</p>
                    </div>
                    <button onclick="filterAud('mission')" class="w-full px-4 py-3 bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 rounded-xl font-semibold transition-all duration-300 mb-6 shadow-lg transform hover:scale-105">View</button>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between p-2 bg-orange-950/30 rounded-lg"><span class="text-orange-300">Bone Health</span><span class="text-white font-bold">200</span></div>
                        <div class="flex justify-between p-2 bg-orange-950/30 rounded-lg"><span class="text-orange-300">Muscle Atrophy</span><span class="text-white font-bold">180</span></div>
                    </div>
                </div>
            </div>
            <div id="audResults" style="display:none;">
                <div class="glass-card rounded-xl p-6 shadow-2xl border border-gray-700/50">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white" id="audTitle"></h3>
                        <button onclick="closeAud()" class="px-6 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-all duration-300">Close</button>
                    </div>
                    <div id="audPubs" class="space-y-4 max-h-[600px] overflow-y-auto pr-2 scrollbar-thin"></div>
                </div>
            </div>
        </section>
    </div>
    <script>
const mockData = {
    publications: Array.from({length: 100}, (_, i) => ({
        title: `Effects of Microgravity on ${['Human Cells', 'Mouse Models', 'Yeast Strains', 'Plant Tissues'][i % 4]} - Study ${i + 1}`,
        year: 2005 + Math.floor(Math.random() * 21),
        journal: ['Astrobiology', 'Space Medicine', 'Microgravity Research', 'NASA Technical Reports'][i % 4],
        pmcid: Math.random() > 0.7 ? `PMC${1000 + i}` : null,
        authors: `Smith J, Johnson A${i % 3 === 0 ? ', et al.' : ''}`,
        abstract: `This study investigates the biological impacts of spaceflight conditions on various levels. Key findings include altered gene expression patterns under microgravity, with implications for long-duration missions.`,
        organisms: [i % 4 === 0 ? 'Human' : i % 4 === 1 ? 'Mouse' : i % 4 === 2 ? 'Yeast' : 'Plant'],
        research_areas: [i % 5 === 0 ? 'Gene Expression' : i % 5 === 1 ? 'Bone Health' : i % 5 === 2 ? 'Muscle Atrophy' : i % 5 === 3 ? 'Radiation Effects' : 'Immune Response'],
        scientist_relevance: Math.floor(Math.random() * 3) + 1,
        manager_relevance: Math.floor(Math.random() * 3) + 1,
        mission_planner_relevance: Math.floor(Math.random() * 3) + 1
    })),
    statistics: {
        organism_counts: { Human: 300, Mouse: 250, Yeast: 200, Plant: 250 },
        research_area_counts: { 'Gene Expression': 250, 'Bone Health': 200, 'Muscle Atrophy': 180, 'Radiation Effects': 150, 'Immune Response': 220 },
        condition_counts: { Microgravity: 800, Radiation: 400, Hypergravity: 100 },
        year_distribution: Object.fromEntries(Array.from({length: 21}, (_, i) => [2005 + i, 20 + Math.floor(Math.random() * 50)])),
        knowledge_gaps: Array.from({length: 10}, (_, i) => ({ combination: `Model ${i + 1} + Effect ${i % 5 + 1}`, publication_count: Math.floor(Math.random() * 4) + 1 })),
        consensus_areas: Array.from({length: 5}, (_, i) => ({ area: `Consensus Area ${i + 1}`, publication_count: 50 + Math.floor(Math.random() * 100) })),
        recent_trends: Array.from({length: 8}, (_, i) => ({ area: `Trend ${i + 1}`, recent_publications: 10 + Math.floor(Math.random() * 40) })),
        stage_distribution: { Exploratory: 200, Applied: 500, Translational: 300 }
    }
};

const allPubs = mockData.publications;
const stats = mockData.statistics;
let displayedCount = 10;
let graphInitialized = false;

function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    event.target.classList.add('active');
    if (tabId === 'knowledge-graph' && !graphInitialized) {
        initGraph();
        graphInitialized = true;
    }
}

function createPubCard(pub) {
    return `
        <div class="publication-card glass-card rounded-xl p-6 border-2 border-gray-700/50 shadow-xl"
             data-organisms='${JSON.stringify(pub.organisms)}'
             data-areas='${JSON.stringify(pub.research_areas)}'
             data-year="${pub.year}">
            <h3 class="text-xl font-bold mb-3 text-blue-400">${pub.title}</h3>
            <div class="flex flex-wrap gap-2 mb-3">
                <span class="px-3 py-1 bg-gray-700/60 text-gray-300 rounded-full text-xs font-medium">${pub.year}</span>
                <span class="px-3 py-1 bg-gray-700/60 text-gray-300 rounded-full text-xs font-medium">${pub.journal}</span>
                ${pub.pmcid ? `<span class="px-3 py-1 bg-gray-700/60 text-gray-300 rounded-full text-xs font-medium">${pub.pmcid}</span>` : ''}
            </div>
            <p class="text-gray-400 text-xs mb-4">${pub.authors}</p>
            <p class="text-gray-300 mb-4 leading-relaxed text-sm">${pub.abstract}</p>
            <div class="flex flex-wrap gap-2 mb-4">
                ${pub.organisms.map(org => `<span class="px-3 py-1 bg-green-900/40 text-green-200 rounded-full text-xs font-medium border border-green-700/30">${org}</span>`).join('')}
                ${pub.research_areas.map(area => `<span class="px-3 py-1 bg-purple-900/40 text-purple-200 rounded-full text-xs font-medium border border-purple-700/30">${area}</span>`).join('')}
            </div>
            <div class="flex gap-2 text-xs flex-wrap">
                <span class="px-2 py-1 bg-blue-900/40 text-blue-200 rounded-full border border-blue-700/30">${'⭐'.repeat(pub.scientist_relevance)}</span>
                <span class="px-2 py-1 bg-purple-900/40 text-purple-200 rounded-full border border-purple-700/30">${'⭐'.repeat(pub.manager_relevance)}</span>
                <span class="px-2 py-1 bg-orange-900/40 text-orange-200 rounded-full border border-orange-700/30">${'⭐'.repeat(pub.mission_planner_relevance)}</span>
            </div>
        </div>
    `;
}

function filterPubs() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const orgFilter = document.getElementById('orgFilter').value;
    const areaFilter = document.getElementById('areaFilter').value;
    const yearFilter = document.getElementById('yearFilter').value;
    const cards = document.querySelectorAll('#pubsList .publication-card');
    let visibleCount = 0;

    cards.forEach(card => {
        const text = card.textContent.toLowerCase();
        const organisms = JSON.parse(card.dataset.organisms || '[]');
        const areas = JSON.parse(card.dataset.areas || '[]');
        const year = parseInt(card.dataset.year) || 0;
        let show = true;

        if (searchTerm && !text.includes(searchTerm)) show = false;
        if (orgFilter && !organisms.includes(orgFilter)) show = false;
        if (areaFilter && !areas.includes(areaFilter)) show = false;
        
        if (yearFilter) {
            const currentYear = 2025;
            if (yearFilter === 'recent' && year < currentYear - 5) show = false;
            if (yearFilter === '2015-2020' && (year < 2015 || year > 2020)) show = false;
            if (yearFilter === '2010-2015' && (year < 2010 || year > 2015)) show = false;
        }

        card.style.display = show ? 'block' : 'none';
        if (show) visibleCount++;
    });

    document.getElementById('resultCount').textContent = `${visibleCount} publication${visibleCount !== 1 ? 's' : ''}`;
}

function loadMore() {
    displayedCount += 10;
    const container = document.getElementById('pubsList');
    const newPubs = allPubs.slice(container.children.length, displayedCount);
    newPubs.forEach(pub => container.insertAdjacentHTML('beforeend', createPubCard(pub)));
    if (displayedCount >= allPubs.length) {
        document.getElementById('loadBtn').style.display = 'none';
    }
}

function filterAud(audience) {
    const relevanceField = `${audience}_relevance`;
    const filtered = allPubs.filter(pub => pub[relevanceField] >= 2).slice(0, 15);
    const titles = {
        scientist: 'High-Relevance Publications for Scientists',
        manager: 'High-Impact Publications for Managers',
        mission: 'Mission-Critical Publications for Planners'
    };
    document.getElementById('audTitle').textContent = titles[audience];
    document.getElementById('audPubs').innerHTML = filtered.map(createPubCard).join('');
    document.getElementById('audResults').style.display = 'block';
    document.getElementById('audResults').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function closeAud() {
    document.getElementById('audResults').style.display = 'none';
}

function initCharts() {
    const commonOpts = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: {
                    color: '#E5E7EB',
                    font: { size: 13, weight: '500' },
                    padding: 15
                }
            }
        }
    };

    const yearLabels = Object.keys(stats.year_distribution).sort();
    new Chart(document.getElementById('yearChart'), {
        type: 'line',
        data: {
            labels: yearLabels,
            datasets: [{
                label: 'Publications per Year',
                data: yearLabels.map(y => stats.year_distribution[y]),
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                borderColor: '#3B82F6',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 5,
                pointHoverRadius: 7,
                pointBackgroundColor: '#3B82F6',
                pointBorderColor: '#fff',
                pointBorderWidth: 2
            }]
        },
        options: {
            ...commonOpts,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#9CA3AF', font: { size: 12 } },
                    grid: { color: '#374151' }
                },
                x: {
                    ticks: { color: '#9CA3AF', font: { size: 12 } },
                    grid: { color: '#374151' }
                }
            }
        }
    });

    new Chart(document.getElementById('organismChart'), {
        type: 'doughnut',
        data: {
            labels: Object.keys(stats.organism_counts),
            datasets: [{
                data: Object.values(stats.organism_counts),
                backgroundColor: ['#10B981', '#8B5CF6', '#F59E0B', '#EF4444'],
                borderWidth: 3,
                borderColor: '#1F2937',
                hoverOffset: 10
            }]
        },
        options: {
            ...commonOpts,
            plugins: {
                legend: { position: 'bottom', labels: { color: '#E5E7EB', padding: 15, font: { size: 13 } } }
            }
        }
    });

    const topAreas = Object.entries(stats.research_area_counts).sort((a, b) => b[1] - a[1]);
    new Chart(document.getElementById('researchAreaChart'), {
        type: 'bar',
        data: {
            labels: topAreas.map(([area]) => area),
            datasets: [{
                label: 'Publications',
                data: topAreas.map(([, count]) => count),
                backgroundColor: '#A855F7',
                borderColor: '#9333EA',
                borderWidth: 2,
                borderRadius: 6
            }]
        },
        options: {
            ...commonOpts,
            indexAxis: 'y',
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: { color: '#9CA3AF', font: { size: 12 } },
                    grid: { color: '#374151' }
                },
                y: {
                    ticks: { color: '#9CA3AF', font: { size: 12 } },
                    grid: { display: false }
                }
            },
            plugins: { legend: { display: false } }
        }
    });

    new Chart(document.getElementById('conditionChart'), {
        type: 'polarArea',
        data: {
            labels: Object.keys(stats.condition_counts),
            datasets: [{
                data: Object.values(stats.condition_counts),
                backgroundColor: [
                    'rgba(59, 130, 246, 0.7)',
                    'rgba(16, 185, 129, 0.7)',
                    'rgba(245, 158, 11, 0.7)'
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            ...commonOpts,
            scales: {
                r: {
                    ticks: { color: '#9CA3AF', backdropColor: 'transparent' },
                    grid: { color: '#374151' }
                }
            }
        }
    });

    new Chart(document.getElementById('stageChart'), {
        type: 'pie',
        data: {
            labels: Object.keys(stats.stage_distribution),
            datasets: [{
                data: Object.values(stats.stage_distribution),
                backgroundColor: ['#3B82F6', '#8B5CF6', '#10B981'],
                borderWidth: 3,
                borderColor: '#1F2937',
                hoverOffset: 8
            }]
        },
        options: {
            ...commonOpts,
            plugins: {
                legend: { position: 'bottom', labels: { color: '#E5E7EB', padding: 12, font: { size: 13 } } }
            }
        }
    });
}

function initGraph() {
    const width = document.getElementById('network-graph').clientWidth;
    const height = 600;

    const nodes = [
        ...Object.keys(stats.organism_counts).map(org => ({
            id: org,
            type: 'organism',
            value: stats.organism_counts[org]
        })),
        ...Object.keys(stats.research_area_counts).map(area => ({
            id: area,
            type: 'area',
            value: stats.research_area_counts[area]
        })),
        ...Object.keys(stats.condition_counts).map(cond => ({
            id: cond,
            type: 'condition',
            value: stats.condition_counts[cond]
        }))
    ];

    const links = [];
    Object.keys(stats.organism_counts).forEach(org => {
        Object.keys(stats.research_area_counts).forEach(area => {
            if (Math.random() > 0.3) {
                links.push({ source: org, target: area, value: Math.floor(Math.random() * 50) + 10 });
            }
        });
        Object.keys(stats.condition_counts).forEach(cond => {
            if (Math.random() > 0.5) {
                links.push({ source: org, target: cond, value: Math.floor(Math.random() * 100) + 50 });
            }
        });
    });

    const svg = d3.select('#network-graph')
        .append('svg')
        .attr('width', width)
        .attr('height', height);

    const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(150))
        .force('charge', d3.forceManyBody().strength(-300))
        .force('center', d3.forceCenter(width / 2, height / 2))
        .force('collision', d3.forceCollide().radius(50));

    const link = svg.append('g')
        .selectAll('line')
        .data(links)
        .join('line')
        .attr('stroke', '#4B5563')
        .attr('stroke-opacity', 0.6)
        .attr('stroke-width', d => Math.sqrt(d.value) / 2);

    const node = svg.append('g')
        .selectAll('g')
        .data(nodes)
        .join('g')
        .call(d3.drag()
            .on('start', dragstarted)
            .on('drag', dragged)
            .on('end', dragended));

    node.append('circle')
        .attr('r', d => Math.sqrt(d.value) * 2.5)
        .attr('fill', d => {
            if (d.type === 'organism') return '#3B82F6';
            if (d.type === 'area') return '#A855F7';
            return '#10B981';
        })
        .attr('stroke', '#fff')
        .attr('stroke-width', 2)
        .style('filter', 'drop-shadow(0 0 10px rgba(0,0,0,0.5))');

    node.append('text')
        .text(d => d.id)
        .attr('x', 0)
        .attr('y', 4)
        .attr('text-anchor', 'middle')
        .attr('fill', '#fff')
        .attr('font-size', '11px')
        .attr('font-weight', 'bold')
        .attr('pointer-events', 'none')
        .style('text-shadow', '0 0 3px rgba(0,0,0,0.8)');

    node.append('title')
        .text(d => `${d.id}\n${d.value} publications`);

    simulation.on('tick', () => {
        link
            .attr('x1', d => d.source.x)
            .attr('y1', d => d.source.y)
            .attr('x2', d => d.target.x)
            .attr('y2', d => d.target.y);

        node.attr('transform', d => `translate(${d.x},${d.y})`);
    });

    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }

    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }

    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }
}

function populateInsights() {
    document.getElementById('gaps').innerHTML = stats.knowledge_gaps.map(gap => `
        <div class="bg-gray-700/40 rounded-lg p-4 border-l-4 border-yellow-500 hover:bg-gray-700/60 transition-all duration-300">
            <p class="font-semibold text-white">${gap.combination}</p>
            <p class="text-sm text-gray-400">${gap.publication_count} publication${gap.publication_count !== 1 ? 's' : ''}</p>
        </div>
    `).join('');

    document.getElementById('consensus').innerHTML = stats.consensus_areas.map(area => `
        <div class="bg-gray-700/40 rounded-lg p-4 border-l-4 border-green-500 hover:bg-gray-700/60 transition-all duration-300">
            <div class="flex justify-between items-center">
                <p class="font-semibold text-white">${area.area}</p>
                <span class="px-3 py-1 bg-green-900/60 text-green-200 rounded-full text-xs font-bold">${area.publication_count}</span>
            </div>
        </div>
    `).join('');

    const maxPubs = Math.max(...stats.recent_trends.map(t => t.recent_publications));
    document.getElementById('trends').innerHTML = stats.recent_trends.map(trend => `
        <div class="bg-gray-700/40 rounded-lg p-3 hover:bg-gray-700/60 transition-all duration-300">
            <div class="flex justify-between items-center mb-2">
                <p class="font-semibold text-white">${trend.area}</p>
                <span class="text-blue-400 font-bold">${trend.recent_publications}</span>
            </div>
            <div class="w-full bg-gray-600 rounded-full h-2">
                <div class="bg-gradient-to-r from-blue-500 to-blue-400 h-2 rounded-full transition-all duration-500" style="width: ${(trend.recent_publications / maxPubs) * 100}%"></div>
            </div>
        </div>
    `).join('');

    document.getElementById('stageInfo').innerHTML = Object.entries(stats.stage_distribution).map(([stage, count]) => `
        <div class="flex justify-between items-center">
            <span class="text-gray-400 font-medium">${stage}</span>
            <span class="text-white font-bold">${count} (${Math.round((count / 1000) * 100)}%)</span>
        </div>
    `).join('');
}

window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('pubsList').innerHTML = allPubs.slice(0, 10).map(createPubCard).join('');
    initCharts();
    populateInsights();
});
</script>
</body>
</html>
