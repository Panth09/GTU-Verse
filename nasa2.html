<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Space Biology Knowledge Engine</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --primary-blue:#3B82F6; --accent-purple:#A855F7; --highlight-green:#10B981;
      --warning-orange:#F59E0B; --bg-dark:#0f172a; --card-bg:rgba(31,41,55,.6);
    }
    body{background:linear-gradient(135deg,var(--bg-dark) 0%,#1e3a8a 50%,var(--bg-dark) 100%);
      font-family:'Inter',sans-serif; overscroll-behavior:none;}
    .tab-content{display:none}.tab-content.active{display:block}
    .stat-card{transition:transform .3s, box-shadow .3s; backdrop-filter:blur(8px)}
    .stat-card:hover{transform:translateY(-10px); box-shadow:0 15px 30px rgba(0,0,0,.5)}
    .publication-card{transition:.3s;border:2px solid transparent}
    .publication-card:hover{transform:translateY(-5px); box-shadow:0 12px 24px rgba(59,130,246,.4); border-color:var(--primary-blue)}
    .line-clamp-2{-webkit-line-clamp:2; display:-webkit-box; -webkit-box-orient:vertical; overflow:hidden}
    .line-clamp-3{-webkit-line-clamp:3; display:-webkit-box; -webkit-box-orient:vertical; overflow:hidden}
    .scrollbar-thin::-webkit-scrollbar{width:6px}
    .scrollbar-thin::-webkit-scrollbar-track{background:#1f2937;border-radius:3px}
    .scrollbar-thin::-webkit-scrollbar-thumb{background:var(--primary-blue);border-radius:3px}
    .scrollbar-thin::-webkit-scrollbar-thumb:hover{background:#2563eb}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)}}
    .animate-fade-in{animation:fadeIn .8s ease-out}
    .chart-wrapper{height:20rem; position:relative}
    #network-graph{width:100%;height:600px;background:var(--card-bg);border-radius:16px;overflow:hidden}
  </style>
</head>
<body class="text-white min-h-screen">
  <div class="container mx-auto px-4 py-12 max-w-7xl">
    <header class="text-center mb-12 animate-fade-in">
      <h1 class="text-5xl md:text-6xl font-extrabold mb-4 bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent drop-shadow-xl">
        Space Biology Knowledge Engine
      </h1>
      <p class="text-gray-200 text-xl md:text-2xl mb-2">NASA Space Apps Challenge 2025</p>
      <p class="text-gray-400 text-base">Analyzing <span id="totalPubs">0</span> Real Bioscience Publications</p>
    </header>
    <nav class="flex flex-wrap justify-center gap-4 mb-12" role="tablist">
      <button onclick="app.showTab('overview')" class="tab-btn px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-semibold transition-all shadow-lg focus:outline-none focus:ring-2 ring-offset-2 ring-blue-500" role="tab" aria-selected="true">Overview</button>
      <button onclick="app.showTab('search')" class="tab-btn px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-semibold transition-all shadow-lg focus:outline-none focus:ring-2 ring-offset-2 ring-blue-500" role="tab">Search & Explore</button>
      <button onclick="app.showTab('insights')" class="tab-btn px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-semibold transition-all shadow-lg focus:outline-none focus:ring-2 ring-offset-2 ring-blue-500" role="tab">AI Insights</button>
      <button onclick="app.showTab('knowledge-graph')" class="tab-btn px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-semibold transition-all shadow-lg focus:outline-none focus:ring-2 ring-offset-2 ring-blue-500" role="tab">Knowledge Graph</button>
      <button onclick="app.showTab('audience')" class="tab-btn px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-semibold transition-all shadow-lg focus:outline-none focus:ring-2 ring-offset-2 ring-blue-500" role="tab">By Audience</button>
    </nav>
    <!-- TAB 1: OVERVIEW -->
    <section id="overview" class="tab-content active" role="tabpanel">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
        <div class="stat-card bg-gradient-to-br from-blue-900 to-blue-800 rounded-xl p-6 shadow-2xl border border-blue-700/50">
          <h3 class="text-blue-300 text-sm font-medium mb-2">Total Publications</h3>
          <p class="text-5xl font-bold text-white" id="statTotal">0</p>
        </div>
        <div class="stat-card bg-gradient-to-br from-green-900 to-green-800 rounded-xl p-6 shadow-2xl border border-green-700/50">
          <h3 class="text-green-300 text-sm font-medium mb-2">Organisms Studied</h3>
          <p class="text-5xl font-bold text-white" id="statOrganisms">0</p>
        </div>
        <div class="stat-card bg-gradient-to-br from-purple-900 to-purple-800 rounded-xl p-6 shadow-2xl border border-purple-700/50">
          <h3 class="text-purple-300 text-sm font-medium mb-2">Research Areas</h3>
          <p class="text-5xl font-bold text-white" id="statAreas">0</p>
        </div>
        <div class="stat-card bg-gradient-to-br from-orange-900 to-orange-800 rounded-xl p-6 shadow-2xl border border-orange-700/50">
          <h3 class="text-orange-300 text-sm font-medium mb-2">Year Span</h3>
          <p class="text-5xl font-bold text-white" id="statYears">â€”</p>
        </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-6 text-blue-400">Publications Timeline</h3>
          <div class="chart-wrapper"><canvas id="yearChart"></canvas></div>
        </div>
        <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-6 text-green-400">Organisms Distribution</h3>
          <div class="chart-wrapper"><canvas id="organismChart"></canvas></div>
        </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-6 text-purple-400">Research Areas</h3>
          <div class="chart-wrapper"><canvas id="researchAreaChart"></canvas></div>
        </div>
        <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-6 text-orange-400">Space Conditions</h3>
          <div class="chart-wrapper"><canvas id="conditionChart"></canvas></div>
        </div>
      </div>
    </section>
    <!-- TAB 2: SEARCH & EXPLORE -->
    <section id="search" class="tab-content" role="tabpanel">
      <div class="mb-8">
        <input type="text" id="searchInput" placeholder="Search by title, abstract, organism, or research area..."
          class="w-full px-6 py-4 bg-gray-800/60 border-2 border-gray-700 rounded-xl text-white focus:outline-none focus:border-blue-500 transition-all backdrop-blur-sm shadow-lg"/>
      </div>
      <div class="bg-gray-800/60 rounded-xl p-6 mb-8 border border-gray-700 backdrop-blur-sm shadow-lg">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-white">Filters</h3>
          <button onclick="app.clearFilters()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold transition-all">Clear Filters</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label class="block text-gray-400 text-sm mb-2">Organism</label>
            <select id="organismFilter" class="w-full px-4 py-3 bg-gray-700/60 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 ring-blue-500">
              <option value="">All Organisms</option>
            </select>
          </div>
          <div>
            <label class="block text-gray-400 text-sm mb-2">Research Area</label>
            <select id="areaFilter" class="w-full px-4 py-3 bg-gray-700/60 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 ring-blue-500">
              <option value="">All Areas</option>
            </select>
          </div>
          <div>
            <label class="block text-gray-400 text-sm mb-2">Year Range</label>
            <select id="yearFilter" class="w-full px-4 py-3 bg-gray-700/60 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 ring-blue-500">
              <option value="">All Years</option>
              <option value="recent">Last 5 Years (2020+)</option>
              <option value="2015-2020">2015-2020</option>
              <option value="2010-2015">2010-2015</option>
              <option value="before-2010">Before 2010</option>
            </select>
          </div>
          <div>
            <label class="block text-gray-400 text-sm mb-2">Section Focus</label>
            <select id="sectionFilter" class="w-full px-4 py-3 bg-gray-700/60 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 ring-blue-500">
              <option value="">All Sections</option>
              <option value="introduction">Introduction</option>
              <option value="results">Results</option>
              <option value="conclusion">Conclusion</option>
            </select>
          </div>
        </div>
      </div>
      <div class="mb-6">
        <h2 class="text-3xl font-bold text-white">Publications</h2>
        <p class="text-gray-400 mt-1" id="resultCount">0 publications</p>
      </div>
      <div id="publicationsList" class="space-y-6 max-h-[600px] overflow-y-auto pr-2 scrollbar-thin"></div>
      <div class="text-center mt-8">
        <button onclick="app.loadMore()" id="loadMoreBtn" class="px-8 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-all shadow-lg">
          Load More Publications
        </button>
      </div>
    </section>
    <!-- TAB 3: AI INSIGHTS -->
    <section id="insights" class="tab-content" role="tabpanel">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-4 text-yellow-400">Knowledge Gaps</h3>
          <p class="text-gray-400 mb-4">Underrepresented combinations</p>
          <div class="space-y-3 max-h-80 overflow-y-auto scrollbar-thin" id="knowledgeGaps"></div>
        </div>
        <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-4 text-green-400">Consensus Areas</h3>
          <p class="text-gray-400 mb-4">Well-established research areas</p>
          <div class="space-y-3 max-h-80 overflow-y-auto scrollbar-thin" id="consensusAreas"></div>
        </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
        <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-4 text-blue-400">Recent Trends</h3>
          <p class="text-gray-400 mb-4">Emerging areas (Last 5 years)</p>
          <div class="space-y-3" id="recentTrends"></div>
        </div>
        <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-4 text-purple-400">Research Maturity</h3>
          <div class="chart-wrapper h-64"><canvas id="stageChart"></canvas></div>
          <div class="space-y-2 mt-4" id="stageDetails"></div>
        </div>
      </div>
      <section class="bg-gradient-to-r from-blue-900/80 to-purple-900/80 rounded-xl p-8 shadow-2xl border border-blue-700/50 backdrop-blur-sm">
        <h3 class="text-3xl font-bold mb-6 text-white text-center">Actionable Insights</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-gray-800/70 rounded-lg p-6">
            <h4 class="text-xl font-bold mb-3 text-blue-400">For Scientists</h4>
            <ul class="space-y-2 text-gray-300" id="scientistInsights"></ul>
          </div>
          <div class="bg-gray-800/70 rounded-lg p-6">
            <h4 class="text-xl font-bold mb-3 text-purple-400">For Managers</h4>
            <ul class="space-y-2 text-gray-300" id="managerInsights"></ul>
          </div>
          <div class="bg-gray-800/70 rounded-lg p-6">
            <h4 class="text-xl font-bold mb-3 text-orange-400">For Mission Architects</h4>
            <ul class="space-y-2 text-gray-300" id="missionInsights"></ul>
          </div>
        </div>
      </section>
    </section>
    <!-- TAB 4: KNOWLEDGE GRAPH -->
    <section id="knowledge-graph" class="tab-content" role="tabpanel">
      <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 mb-6 backdrop-blur-sm">
        <h3 class="text-2xl font-bold mb-4 text-purple-400">Research Relationship Network</h3>
        <p class="text-gray-400 mb-2">Interactive connections between organisms, research areas, and space conditions.</p>
        <p class="text-gray-500 text-sm">Drag nodes to explore â€¢ Hover for details â€¢ Node size reflects publication count</p>
      </div>
      <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 mb-6 backdrop-blur-sm">
        <div id="network-graph"></div>
      </div>
      <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
        <h4 class="font-bold mb-3 text-white">Legend</h4>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="flex items-center gap-2"><div class="w-5 h-5 rounded-full bg-blue-500"></div><span class="text-gray-300">Organisms</span></div>
          <div class="flex items-center gap-2"><div class="w-5 h-5 rounded-full bg-purple-500"></div><span class="text-gray-300">Research Areas</span></div>
          <div class="flex items-center gap-2"><div class="w-5 h-5 rounded-full bg-green-500"></div><span class="text-gray-300">Conditions</span></div>
          <div class="flex items-center gap-2"><div class="w-4 h-0.5 bg-gray-400"></div><span class="text-gray-300">Connections</span></div>
        </div>
      </div>
    </section>
    <!-- TAB 5: BY AUDIENCE -->
    <section id="audience" class="tab-content" role="tabpanel">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
        <div class="bg-gradient-to-br from-blue-900/80 to-blue-800/80 rounded-xl p-6 shadow-2xl border border-blue-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-4 text-white">Scientists</h3>
          <p class="text-blue-200 mb-6">Hypothesis & mechanistic research</p>
          <div class="bg-blue-950/50 rounded-lg p-4 mb-4 text-center">
            <p class="text-4xl font-bold text-white mb-1" id="scientistCount">0</p>
            <p class="text-blue-200 text-sm">High Relevance Publications</p>
          </div>
          <button onclick="app.filterByAudience('scientist')" class="w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-all mb-6 shadow-lg">View Publications</button>
          <div class="space-y-2 text-sm" id="scientistTopAreas"></div>
        </div>
        <div class="bg-gradient-to-br from-purple-900/80 to-purple-800/80 rounded-xl p-6 shadow-2xl border border-purple-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-4 text-white">Managers</h3>
          <p class="text-purple-200 mb-6">Investment & portfolio analysis</p>
          <div class="bg-purple-950/50 rounded-lg p-4 mb-4 text-center">
            <p class="text-4xl font-bold text-white mb-1" id="managerCount">0</p>
            <p class="text-purple-200 text-sm">High Impact Publications</p>
          </div>
          <button onclick="app.filterByAudience('manager')" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-all mb-6 shadow-lg">View Publications</button>
          <div class="space-y-2 text-sm" id="managerGaps"></div>
        </div>
        <div class="bg-gradient-to-br from-orange-900/80 to-orange-800/80 rounded-xl p-6 shadow-2xl border border-orange-700/50 backdrop-blur-sm">
          <h3 class="text-2xl font-bold mb-4 text-white">Mission Architects</h3>
          <p class="text-orange-200 mb-6">Health & safety for Moon/Mars</p>
          <div class="bg-orange-950/50 rounded-lg p-4 mb-4 text-center">
            <p class="text-4xl font-bold text-white mb-1" id="missionCount">0</p>
            <p class="text-orange-200 text-sm">Mission-Critical Publications</p>
          </div>
          <button onclick="app.filterByAudience('mission')" class="w-full px-4 py-3 bg-orange-600 hover:bg-orange-700 rounded-lg font-semibold transition-all mb-6 shadow-lg">View Publications</button>
          <div class="space-y-2 text-sm" id="missionTopAreas"></div>
        </div>
      </div>
      <div id="audienceResults" class="mt-8" style="display:none;">
        <div class="bg-gray-800/60 rounded-xl p-6 shadow-2xl border border-gray-700/50 backdrop-blur-sm">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-white" id="audienceTitle"></h3>
            <button onclick="app.closeAudienceView()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-all">Close</button>
          </div>
          <div id="audiencePublications" class="space-y-4 max-h-[600px] overflow-y-auto pr-2 scrollbar-thin"></div>
        </div>
      </div>
    </section>
  </div>
  <footer class="bg-gray-900/80 border-t border-gray-700/50 py-8 mt-16">
    <div class="container mx-auto px-4 max-w-7xl">
      <h3 class="text-2xl font-bold mb-6 text-center text-white">Additional Resources</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
        <div>
          <h4 class="text-lg font-semibold mb-2 text-blue-400">NASA Open Science Data Repository</h4>
          <p class="text-gray-300 mb-4">Primary data from space biology studies</p>
          <a href="https://www.nasa.gov/osdr" target="_blank" class="inline-block text-blue-400 hover:text-blue-300 transition-colors">Explore OSDR</a>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-2 text-purple-400">NASA Space Life Sciences Library</h4>
          <p class="text-gray-300 mb-4">Publications and archives</p>
          <a href="https://sls.ldc.nasa.gov/" target="_blank" class="inline-block text-purple-400 hover:text-purple-300 transition-colors">Visit Library</a>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-2 text-green-400">NASA Task Book</h4>
          <p class="text-gray-300 mb-4">Grant funding information</p>
          <a href="https://taskbook.nasaprs.com/" target="_blank" class="inline-block text-green-400 hover:text-green-300 transition-colors">View Task Book</a>
        </div>
      </div>
      <p class="text-center text-gray-500 mt-8 text-sm">Built for NASA Space Apps Challenge 2025</p>
    </div>
  </footer>
  <!-- JSON Modal -->
  <div id="jsonModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-xl p-6 max-w-4xl w-full max-h-[80vh] overflow-auto">
      <div class="flex justify-between mb-4">
        <h3 class="text-xl font-bold text-white">Publication JSON</h3>
        <button onclick="app.closeJsonModal()" class="text-gray-400 hover:text-white">âœ•</button>
      </div>
      <pre id="jsonContent" class="text-gray-300 bg-gray-900 p-4 rounded-lg overflow-auto"></pre>
    </div>
  </div>
  <script>
  /*************** Data Module (clean + merged) ***************/
  const DataModule = (() => {
    const realPublications = [
      { title:"Mice in Bion-M 1 space mission: training and selection", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4136787/", pmcid:"PMC4136787", year:2014 },
      { title:"Microgravity induces pelvic bone loss through osteoclastic activity, osteocytic osteolysis, and osteoblastic cell cycle inhibition by CDKN1a/p21", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3630201/", pmcid:"PMC3630201", year:2013 },
      { title:"Stem Cell Health and Tissue Regeneration in Microgravity", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11988870/", pmcid:"PMC11988870", year:2024 },
      { title:"Microgravity Reduces the Differentiation and Regenerative Potential of Embryonic Stem Cells", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7998608/", pmcid:"PMC7998608", year:2021 },
      { title:"Microgravity validation of a novel system for RNA isolation and multiplex quantitative real time PCR analysis of gene expression on the International Space Station", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5587110/", pmcid:"PMC5587110", year:2017 },
      { title:"Spaceflight Modulates the Expression of Key Oxidative Stress and Cell Cycle Related Genes in Heart", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8396460/", pmcid:"PMC8396460", year:2021 },
      { title:"Dose- and Ion-Dependent Effects in the Oxidative Stress Response to Space-Like Radiation Exposure in the Skeletal System", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5666799/", pmcid:"PMC5666799", year:2017 },
      { title:"From the bench to exploration medicine: NASA life sciences translational research for human exploration and habitation missions", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5460236/", pmcid:"PMC5460236", year:2017 },
      { title:"High-precision method for cyclic loading of small-animal vertebrae to assess bone quality", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6222041/", pmcid:"PMC6222041", year:2018 },
      { title:"Effects of ex vivo ionizing radiation on collagen structure and whole-bone mechanical properties of mouse vertebrae", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6813909/", pmcid:"PMC6813909", year:2019 },
      { title:"Absence of gamma-sarcoglycan alters the response of p70S6 kinase to mechanical perturbation in murine skeletal muscle", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4095884/", pmcid:"PMC4095884", year:2014 },
      { title:"AtRabD2b and AtRabD2c have overlapping functions in pollen development and pollen tube growth", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3040128/", pmcid:"PMC3040128", year:2011 },
      { title:"TNO1 is involved in salt tolerance and vacuolar trafficking in Arabidopsis", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3177255/", pmcid:"PMC3177255", year:2011 },
      { title:"Functional redundancy between trans-Golgi network SNARE family members in Arabidopsis thaliana", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11500582/", pmcid:"PMC11500582", year:2024 },
      { title:"Root growth movements: Waving and skewing", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5387210/", pmcid:"PMC5387210", year:2017 },
      { title:"Gravitropism and lateral root emergence are dependent on the trans-Golgi network protein TNO1", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4642138/", pmcid:"PMC4642138", year:2015 },
      { title:"TNO1, a TGN-localized SNARE-interacting protein, modulates root skewing in Arabidopsis thaliana", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5387210/", pmcid:"PMC5387210", year:2017 },
      { title:"The Drosophila SUN protein Spag4 ... spermatid nucleus", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2915878/", pmcid:"PMC2915878", year:2010 },
      { title:"Toll mediated infection response is altered by gravity and spaceflight in Drosophila", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3901686/", pmcid:"PMC3901686", year:2014 },
      { title:"Multi-omics analysis of multiple missions to space reveal a theme of lipid dysregulation in mouse liver", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6985101/", pmcid:"PMC6985101", year:2020 },
      { title:"GeneLab ... long-term impact of space radiation on the cardiovascular system by activation of FYN", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6387434/", pmcid:"PMC6387434", year:2019 },
      { title:"FAIRness and usability for open-access omics data systems", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6371294/", pmcid:"PMC6371294", year:2019 },
      { title:"NASA GeneLab platform ... biological response to space radiation in animal models", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7072278/", pmcid:"PMC7072278", year:2020 },
      { title:"Circulating miRNA spaceflight signature reveals targets for countermeasure development", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8441986/", pmcid:"PMC8441986", year:2021 },
      { title:"Machine learning ... antimicrobial resistance on the ISS surface microbiome", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9400218/", pmcid:"PMC9400218", year:2022 },
      { title:"Extraterrestrial Gynecology: ... cancer risk in female astronauts? (review)", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9267413/", pmcid:"PMC9267413", year:2022 },
      { title:"Muscle atrophy phenotype gene expression during spaceflight ... metabolic crosstalk in mice", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9576569/", pmcid:"PMC9576569", year:2022 },
      { title:"Chromosomal positioning and epigenetic architecture influence DNA methylation ... GCR", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10789781/", pmcid:"PMC10789781", year:2024 },
      { title:"SARS-CoV-2 review Part 2 ... systemic effects", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10772081/", pmcid:"PMC10772081", year:2024 },
      { title:"Aging and putative frailty biomarkers are altered by spaceflight", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11166946/", pmcid:"PMC11166946", year:2024 },
      { title:"Space radiation damage rescued by inhibition of key spaceflight associated miRNAs", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11166944/", pmcid:"PMC11166944", year:2024 },
      { title:"Ethical considerations for the age of non-governmental space exploration", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11166968/", pmcid:"PMC11166968", year:2024 },
      { title:"Innate immune responses of Drosophila melanogaster are altered by spaceflight", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7000411/", pmcid:"PMC7000411", year:2020 },
      { title:"Prolonged Exposure to Microgravity Reduces Cardiac Contractility and Initiates Remodeling in Drosophila", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7787258/", pmcid:"PMC7787258", year:2021 },
      { title:"Regulation of plant gravity sensing and signaling by the actin cytoskeleton", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8716943/", pmcid:"PMC8716943", year:2022 },
      { title:"HLB1 ... operates at the intersection of the exocytic and endocytic pathways at the TGN/EE in Arabidopsis", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4826010/", pmcid:"PMC4826010", year:2016 },
      { title:"ERULUS ... specifies root hair growth by maintaining tip-focused cytoplasmic calcium oscillations", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6048781/", pmcid:"PMC6048781", year:2018 },
      { title:"Brassinosteroids inhibit autotropic root straightening ... actin organization", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7010715/", pmcid:"PMC7010715", year:2020 },
      { title:"Cell type-specific imaging of calcium signaling in Arabidopsis thaliana seedling roots using GCaMP3", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7503278/", pmcid:"PMC7503278", year:2020 },
      { title:"SPIRRIG and WAVE/SCAR roles in actin-mediated root hair development", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8364238/", pmcid:"PMC8364238", year:2021 },
      { title:"Microgravity Stress: Bone and Connective Tissue", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11579474/", pmcid:"PMC11579474", year:2024 },
      { title:"S. aureus MscL is a pentamer in vivo ...", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2998437/", pmcid:"PMC2998437", year:2010 },
      { title:"Manipulating the permeation of charged compounds through the MscL nanovalve", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3005423/", pmcid:"PMC3005423", year:2011 },
      { title:"The oligomeric state of the truncated mechanosensitive channel of large conductance shows no variance in vivo", url:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3190158/", pmcid:"PMC3190158", year:2011 }
    ];
    const classifyPublication = (pub) => {
      const t = pub.title.toLowerCase();
      const organisms = [];
      const areas = [];
      const conditions = ['Microgravity'];
      if (t.includes('mouse')||t.includes('mice')||t.includes('murine')) organisms.push('Mouse');
      if (t.includes('human')||t.includes('astronaut')) organisms.push('Human');
      if (t.includes('yeast')||t.includes('s. aureus')||t.includes('microbiome')||t.includes('microbial')) organisms.push('Microbe');
      if (t.includes('plant')||t.includes('arabidopsis')||t.includes('root')||t.includes('pollen')) organisms.push('Plant');
      if (t.includes('drosophila')) organisms.push('Drosophila');
      if (organisms.length===0) organisms.push('Other');
      if (t.includes('gene')||t.includes('expression')||t.includes('rna')||t.includes('mirna')) areas.push('Gene Expression');
      if (t.includes('bone')||t.includes('skeletal')||t.includes('vertebrae')||t.includes('osteoc')) areas.push('Bone Health');
      if (t.includes('muscle')||t.includes('atrophy')||t.includes('cardiac')||t.includes('heart')) areas.push('Muscle & Cardiac');
      if (t.includes('radiation')||t.includes('cosmic')||t.includes('gcr')) { areas.push('Radiation Effects'); conditions.push('Radiation'); }
      if (t.includes('immune')||t.includes('infection')||t.includes('toll')) areas.push('Immune Response');
      if (t.includes('stem cell')||t.includes('regeneration')) areas.push('Stem Cell Biology');
      if (t.includes('metabolic')||t.includes('lipid')) areas.push('Metabolism');
      if (t.includes('ethic')) areas.push('Policy & Ethics');
      if (areas.length===0) areas.push('General Biology');
      const scientist_relevance = (areas.includes('Gene Expression') || areas.includes('Radiation Effects')) ? 3 : 2;
      const manager_relevance = (pub.year>=2020) ? 3 : 2;
      const mission_planner_relevance = (areas.includes('Bone Health')||areas.includes('Muscle & Cardiac')||areas.includes('Radiation Effects')) ? 3 : 2;
      return {
        ...pub,
        id: cryptoRandomId(),
        organisms,
        research_areas: areas,
        space_conditions: [...new Set(conditions)],
        scientist_relevance,
        manager_relevance,
        mission_planner_relevance,
        journal: pub.year>=2020 ? 'Contemporary Space Biology' : 'Space Biology Research',
        authors: 'Various Authors, et al.',
        abstract: `This study investigates ${areas.join(', ').toLowerCase()} in ${organisms.join(', ').toLowerCase()} under space conditions.`,
        introduction: `Introduction focuses on ${pub.title}.`,
        results: `Key changes observed in ${areas[0].toLowerCase()}.`,
        conclusion: `Findings inform risks and countermeasures for long-duration missions.`
      };
    };
    const publications = realPublications.map(classifyPublication);
    const stats = (() => {
      const organism_counts = {};
      const research_area_counts = {};
      const condition_counts = { Microgravity: 0, Radiation: 0 };
      const year_distribution = {};
      let high_scientist_relevance=0, high_manager_relevance=0, high_mission_planner_relevance=0;
      publications.forEach(p=>{
        p.organisms.forEach(o=>organism_counts[o]=(organism_counts[o]||0)+1);
        p.research_areas.forEach(a=>research_area_counts[a]=(research_area_counts[a]||0)+1);
        p.space_conditions.forEach(c=>condition_counts[c]=(condition_counts[c]||0)+1);
        year_distribution[p.year]=(year_distribution[p.year]||0)+1;
        if (p.scientist_relevance>=2) high_scientist_relevance++;
        if (p.manager_relevance>=2) high_manager_relevance++;
        if (p.mission_planner_relevance>=2) high_mission_planner_relevance++;
      });
      // Knowledge gaps / consensus
      const knowledge_gaps = [];
      const consensus_areas = [];
      const organisms = Object.keys(organism_counts);
      const areas = Object.keys(research_area_counts);
      organisms.forEach(o=>{
        areas.forEach(a=>{
          const count = publications.filter(p=>p.organisms.includes(o)&&p.research_areas.includes(a)).length;
          if (count>0 && count<3) knowledge_gaps.push({ combination:`${o} + ${a}`, publication_count:count });
          if (count>=5) consensus_areas.push({ area:`${a} in ${o}`, publication_count:count });
        });
      });
      // Recent trends (>=2020)
      const trendMap = {};
      publications.filter(p=>p.year>=2020).forEach(p=>p.research_areas.forEach(a=>trendMap[a]=(trendMap[a]||0)+1));
      const recent_trends = Object.entries(trendMap)
        .map(([area,count])=>({area, recent_publications:count}))
        .sort((a,b)=>b.recent_publications-a.recent_publications).slice(0,8);
      // Stage distribution (mock but stable)
      const stage_distribution = { Exploratory: 12, Applied: 20, Translational: 13 };
      return {
        total_publications: publications.length,
        organism_counts, research_area_counts, condition_counts, year_distribution,
        knowledge_gaps, consensus_areas, recent_trends, stage_distribution,
        high_scientist_relevance, high_manager_relevance, high_mission_planner_relevance
      };
    })();
    function cryptoRandomId(){ return 'p'+Math.random().toString(36).slice(2)+Date.now().toString(36); }
    return { publications, stats };
  })();
  /*************** App (UI + Logic) ***************/
  const app = (() => {
    let filtered = [...DataModule.publications];
    let page = 1;
    const pageSize = 8;
    // Elements
    const els = {
      totalPubs: document.getElementById('totalPubs'),
      statTotal: document.getElementById('statTotal'),
      statOrganisms: document.getElementById('statOrganisms'),
      statAreas: document.getElementById('statAreas'),
      statYears: document.getElementById('statYears'),
      yearChart: document.getElementById('yearChart'),
      organismChart: document.getElementById('organismChart'),
      researchAreaChart: document.getElementById('researchAreaChart'),
      conditionChart: document.getElementById('conditionChart'),
      searchInput: document.getElementById('searchInput'),
      organismFilter: document.getElementById('organismFilter'),
      areaFilter: document.getElementById('areaFilter'),
      yearFilter: document.getElementById('yearFilter'),
      sectionFilter: document.getElementById('sectionFilter'),
      publicationsList: document.getElementById('publicationsList'),
      resultCount: document.getElementById('resultCount'),
      loadMoreBtn: document.getElementById('loadMoreBtn'),
      knowledgeGaps: document.getElementById('knowledgeGaps'),
      consensusAreas: document.getElementById('consensusAreas'),
      recentTrends: document.getElementById('recentTrends'),
      stageChart: document.getElementById('stageChart'),
      stageDetails: document.getElementById('stageDetails'),
      scientistInsights: document.getElementById('scientistInsights'),
      managerInsights: document.getElementById('managerInsights'),
      missionInsights: document.getElementById('missionInsights'),
      scientistCount: document.getElementById('scientistCount'),
      managerCount: document.getElementById('managerCount'),
      missionCount: document.getElementById('missionCount'),
      scientistTopAreas: document.getElementById('scientistTopAreas'),
      managerGaps: document.getElementById('managerGaps'),
      missionTopAreas: document.getElementById('missionTopAreas'),
      audienceResults: document.getElementById('audienceResults'),
      audienceTitle: document.getElementById('audienceTitle'),
      audiencePublications: document.getElementById('audiencePublications'),
      network: document.getElementById('network-graph'),
      jsonModal: document.getElementById('jsonModal'),
      jsonContent: document.getElementById('jsonContent'),
    };
    /* ---- Tabs ---- */
    function showTab(id){
      document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
        btn.classList.add('bg-gray-700', 'hover:bg-gray-600');
        btn.setAttribute('aria-selected', 'false');
        if (btn.getAttribute('onclick').includes(`'${id}'`)) {
          btn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
          btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
          btn.setAttribute('aria-selected', 'true');
        }
      });
      // Lazy render heavy things
      if (id==='knowledge-graph' && !els.network.dataset.rendered){ renderGraph(); els.network.dataset.rendered='1'; }
    }
    /* ---- JSON Modal ---- */
    function showJsonModal(json) {
      els.jsonContent.textContent = json;
      els.jsonModal.classList.remove('hidden');
    }
    function closeJsonModal() {
      els.jsonModal.classList.add('hidden');
    }
    /* ---- Filters/Search ---- */
    function bindFilters(){
      els.searchInput.addEventListener('input', resetAndRender);
      [els.organismFilter, els.areaFilter, els.yearFilter, els.sectionFilter].forEach(sel=>{
        sel.addEventListener('change', resetAndRender);
      });
    }
    function resetAndRender(){
      page = 1;
      applyFilters();
      renderPublications(true);
    }
    function applyFilters(){
      const q = els.searchInput.value.trim().toLowerCase();
      const org = els.organismFilter.value;
      const area = els.areaFilter.value;
      const yr = els.yearFilter.value;
      const sec = els.sectionFilter.value;
      filtered = DataModule.publications.filter(p=>{
        // search
        const hay = [p.title, p.abstract, p.research_areas.join(' '), p.organisms.join(' ')].join(' ').toLowerCase();
        if (q && !hay.includes(q)) return false;
        // organism filter
        if (org && !p.organisms.includes(org)) return false;
        // area filter
        if (area && !p.research_areas.includes(area)) return false;
        // year filter
        if (yr==='recent' && !(p.year>=2020)) return false;
        if (yr==='2015-2020' && !(p.year>=2015 && p.year<=2020)) return false;
        if (yr==='2010-2015' && !(p.year>=2010 && p.year<=2015)) return false;
        if (yr==='before-2010' && !(p.year<2010)) return false;
        // section focus (for demo, match presence of text)
        if (sec && !((p[sec]||'').length>0)) return false;
        return true;
      });
      els.resultCount.textContent = `${filtered.length} publication${filtered.length!==1?'s':''}`;
    }
    function clearFilters(){
      els.searchInput.value = '';
      els.organismFilter.value = '';
      els.areaFilter.value = '';
      els.yearFilter.value = '';
      els.sectionFilter.value = '';
      resetAndRender();
    }
    /* ---- Publications list + Pagination ---- */
    function renderPublications(reset=false){
      if (reset) els.publicationsList.innerHTML='';
      const start = (page-1)*pageSize;
      const slice = filtered.slice(start, start+pageSize);
      slice.forEach(renderPublicationCard);
      // toggle load more
      if (start + pageSize >= filtered.length) {
        els.loadMoreBtn.style.display='none';
      } else {
        els.loadMoreBtn.style.display='inline-block';
      }
    }
    function renderPublicationCard(p){
      const card = document.createElement('div');
      card.className = 'publication-card bg-gray-800/70 rounded-xl p-5 border border-gray-700';
      const prettyJson = JSON.stringify(p, null, 2);
      card.innerHTML = `
        <div class="flex flex-col md:flex-row gap-4 md:items-center">
          <div class="flex-1">
            <a href="${p.url}" target="_blank" class="text-xl font-semibold text-white hover:text-blue-300">${p.title}</a>
            <div class="mt-1 text-gray-400 text-sm">PMCID: ${p.pmcid} â€¢ ${p.journal} â€¢ <span class="font-medium">${p.year}</span></div>
            <p class="mt-3 text-gray-300 line-clamp-2">${p.abstract}</p>
            <div class="mt-3 flex flex-wrap gap-2">
              ${p.organisms.map(o=>`<span class="px-2 py-1 text-xs rounded bg-blue-900/60 border border-blue-700/50">${o}</span>`).join('')}
              ${p.research_areas.map(a=>`<span class="px-2 py-1 text-xs rounded bg-purple-900/60 border border-purple-700/50">${a}</span>`).join('')}
              ${p.space_conditions.map(c=>`<span class="px-2 py-1 text-xs rounded bg-green-900/60 border border-green-700/50">${c}</span>`).join('')}
            </div>
          </div>
          <div class="md:w-56 flex md:block gap-2">
            <a href="${p.url}" target="_blank" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition">Open</a>
            <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition" onclick='app.showJsonModal(${JSON.stringify(prettyJson)})'>Quick JSON</button>
          </div>
        </div>
      `;
      els.publicationsList.appendChild(card);
    }
    function loadMore(){ page++; renderPublications(); }
    /* ---- Overview stats + Charts ---- */
    function renderStatsAndCharts(){
      const s = DataModule.stats;
      els.totalPubs.textContent = s.total_publications;
      els.statTotal.textContent = s.total_publications;
      els.statOrganisms.textContent = Object.keys(s.organism_counts).length;
      els.statAreas.textContent = Object.keys(s.research_area_counts).length;
      const years = Object.keys(s.year_distribution).map(Number).sort((a,b)=>a-b);
      els.statYears.textContent = `${Math.min(...years)}â€“${Math.max(...years)}`;
      new Chart(els.yearChart, {
        type:'line',
        data:{ labels:years, datasets:[{ label:'Publications', data:years.map(y=>s.year_distribution[y]||0), tension:.3, fill:false }] },
        options:{ responsive:true, plugins:{ legend:{display:false} } }
      });
      const orgLabels = Object.keys(s.organism_counts);
      new Chart(els.organismChart, {
        type:'doughnut',
        data:{ labels:orgLabels, datasets:[{ data:orgLabels.map(k=>s.organism_counts[k]) }] },
        options:{ responsive:true, plugins:{ legend:{ position:'bottom' } } }
      });
      const areaLabels = Object.keys(s.research_area_counts).sort((a,b)=>s.research_area_counts[b]-s.research_area_counts[a]).slice(0,10);
      new Chart(els.researchAreaChart, {
        type:'bar',
        data:{ labels:areaLabels, datasets:[{ label:'Count', data:areaLabels.map(k=>s.research_area_counts[k]) }] },
        options:{ responsive:true, plugins:{ legend:{display:false} }, scales:{ x:{ticks:{autoSkip:false}} } }
      });
      const condLabels = Object.keys(s.condition_counts);
      new Chart(els.conditionChart, {
        type:'pie',
        data:{ labels:condLabels, datasets:[{ data:condLabels.map(k=>s.condition_counts[k]) }] },
        options:{ responsive:true, plugins:{ legend:{ position:'bottom' } } }
      });
    }
    /* ---- Insights ---- */
    function renderInsights(){
      const s = DataModule.stats;
      els.knowledgeGaps.innerHTML = s.knowledge_gaps
        .sort((a,b)=>a.publication_count-b.publication_count)
        .slice(0,12)
        .map(g=>`<div class="p-3 rounded bg-yellow-900/40 border border-yellow-700/40 flex justify-between">
          <span>${g.combination}</span><span class="text-yellow-300 font-semibold">${g.publication_count}</span>
        </div>`).join('');
      els.consensusAreas.innerHTML = s.consensus_areas
        .sort((a,b)=>b.publication_count-a.publication_count)
        .slice(0,12)
        .map(c=>`<div class="p-3 rounded bg-green-900/40 border border-green-700/40 flex justify-between">
          <span>${c.area}</span><span class="text-green-300 font-semibold">${c.publication_count}</span>
        </div>`).join('');
      els.recentTrends.innerHTML = s.recent_trends
        .map(t=>`<div class="p-3 rounded bg-blue-900/40 border border-blue-700/40 flex justify-between">
          <span>${t.area}</span><span class="text-blue-300 font-semibold">${t.recent_publications}</span>
        </div>`).join('');
      new Chart(els.stageChart, {
        type:'radar',
        data:{ labels:Object.keys(s.stage_distribution),
          datasets:[{ label:'Studies', data:Object.values(s.stage_distribution) }] },
        options:{ responsive:true, plugins:{ legend:{display:false} } }
      });
      els.stageDetails.innerHTML = Object.entries(s.stage_distribution)
        .map(([k,v])=>`<div class="flex justify-between p-2 rounded bg-purple-900/30 border border-purple-700/30"><span>${k}</span><span class="text-purple-300 font-semibold">${v}</span></div>`).join('');
      // Audience quick insights
      els.scientistCount.textContent = s.high_scientist_relevance;
      els.managerCount.textContent = s.high_manager_relevance;
      els.missionCount.textContent = s.high_mission_planner_relevance;
      const topAreasForScientists = Object.entries(s.research_area_counts).sort((a,b)=>b[1]-a[1]).slice(0,5);
      els.scientistTopAreas.innerHTML = topAreasForScientists.map(([a,c])=>`<div class="flex justify-between text-blue-200"><span>${a}</span><span>${c}</span></div>`).join('');
      const topGapsForManagers = s.knowledge_gaps.slice(0,5);
      els.managerGaps.innerHTML = topGapsForManagers.map(g=>`<div class="flex justify-between text-purple-200"><span>${g.combination}</span><span>${g.publication_count}</span></div>`).join('');
      const missionAreas = ['Bone Health','Muscle & Cardiac','Radiation Effects'];
      els.missionTopAreas.innerHTML = missionAreas
        .filter(a=>s.research_area_counts[a])
        .map(a=>`<div class="flex justify-between text-orange-200"><span>${a}</span><span>${s.research_area_counts[a]}</span></div>`).join('');
      // Actionable bullets
      els.scientistInsights.innerHTML = `
        <li>Prioritize gaps: ${s.knowledge_gaps.slice(0,2).map(g=>g.combination).join(' & ')}.</li>
        <li>Cross-validate radiation findings with omics (GeneLab datasets).</li>
        <li>Pair plant gravity-sensing with microbe studies for closed-loop habitats.</li>`;
      els.managerInsights.innerHTML = `
        <li>Invest in countermeasure paths: Bone/Muscle + Radiation combo studies.</li>
        <li>Expand 2020+ lines showing momentum (e.g., ${s.recent_trends[0]?.area||'Gene Expression'}).</li>
        <li>Fund standard protocols to improve reproducibility across missions.</li>`;
      els.missionInsights.innerHTML = `
        <li>Adopt risk models combining ${['Bone Health','Muscle & Cardiac','Radiation Effects'].join(', ')}.</li>
        <li>Target miRNA-based mitigations showing promise in 2024 studies.</li>
        <li>Plan flight validations for top translational candidates.</li>`;
    }
    /* ---- Audience view ---- */
    function filterByAudience(type){
      let list = [];
      let title = '';
      if (type==='scientist'){ list = DataModule.publications.filter(p=>p.scientist_relevance>=3); title='Scientist-Focused Publications'; }
      if (type==='manager'){ list = DataModule.publications.filter(p=>p.manager_relevance>=3); title='Manager / Investment-Focused Publications'; }
      if (type==='mission'){ list = DataModule.publications.filter(p=>p.mission_planner_relevance>=3); title='Mission-Critical Publications'; }
      els.audiencePublications.innerHTML = list.map(p=>`
        <div class="bg-gray-800/70 rounded-lg p-4 border border-gray-700">
          <a class="text-white font-semibold hover:text-blue-300" target="_blank" href="${p.url}">${p.title}</a>
          <div class="text-gray-400 text-sm mt-1">${p.year} â€¢ ${p.organisms.join(', ')} â€¢ ${p.research_areas.join(', ')}</div>
          <p class="text-gray-300 mt-2 line-clamp-3">${p.abstract}</p>
        </div>
      `).join('');
      els.audienceTitle.textContent = title + ` (${list.length})`;
      els.audienceResults.style.display='block';
      showTab('audience');
    }
    function closeAudienceView(){ els.audienceResults.style.display='none'; }
    /* ---- Knowledge Graph (D3) ---- */
    function renderGraph(){
      const pubs = DataModule.publications;
      const orgSet = new Map(); const areaSet = new Map(); const condSet = new Map();
      const links = [];
      const nodeId = (type, name)=>`${type}:${name}`;
      pubs.forEach(p=>{
        p.organisms.forEach(o=>orgSet.set(o, (orgSet.get(o)||0)+1));
        p.research_areas.forEach(a=>areaSet.set(a, (areaSet.get(a)||0)+1));
        p.space_conditions.forEach(c=>condSet.set(c, (condSet.get(c)||0)+1));
        p.organisms.forEach(o=>{
          p.research_areas.forEach(a=>links.push({ source:nodeId('org',o), target:nodeId('area',a), weight:1 }));
        });
        p.research_areas.forEach(a=>{
          p.space_conditions.forEach(c=>links.push({ source:nodeId('area',a), target:nodeId('cond',c), weight:1 }));
        });
      });
      const nodes = [
        ...Array.from(orgSet.entries()).map(([name,count])=>({ id:nodeId('org',name), label:name, group:'org', count })),
        ...Array.from(areaSet.entries()).map(([name,count])=>({ id:nodeId('area',name), label:name, group:'area', count })),
        ...Array.from(condSet.entries()).map(([name,count])=>({ id:nodeId('cond',name), label:name, group:'cond', count }))
      ];
      // SVG setup
      const width = els.network.clientWidth;
      const height = els.network.clientHeight;
      const svg = d3.select(els.network).append('svg').attr('width', width).attr('height', height);
      const link = svg.append('g').attr('stroke','#9CA3AF').attr('stroke-opacity',0.5)
        .selectAll('line').data(links).join('line').attr('stroke-width', d=>Math.sqrt(d.weight));
      const color = (g)=> g==='org' ? '#3B82F6' : (g==='area' ? '#A855F7' : '#10B981');
      const node = svg.append('g').selectAll('circle').data(nodes).join('circle')
        .attr('r', d=> Math.max(6, Math.min(24, 6 + Math.sqrt(d.count)*3)))
        .attr('fill', d=>color(d.group))
        .attr('stroke', '#111827')
        .attr('stroke-width', 1.5)
        .call(d3.drag()
          .on('start', dragstarted)
          .on('drag', dragged)
          .on('end', dragended))
        .append('title').text(d=>`${d.label} (${d.count})`);
      const label = svg.append('g').selectAll('text').data(nodes).join('text')
        .text(d=>d.label).attr('font-size','10px').attr('fill','#D1D5DB');
      const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d=>d.id).distance(80).strength(0.2))
        .force('charge', d3.forceManyBody().strength(-160))
        .force('center', d3.forceCenter(width/2, height/2))
        .force('collision', d3.forceCollide().radius(d=> Math.max(10, Math.min(28, 8 + Math.sqrt(d.count)*4))))
        .on('tick', ticked);
      function ticked(){
        link.attr('x1', d=>d.source.x).attr('y1', d=>d.source.y).attr('x2', d=>d.target.x).attr('y2', d=>d.target.y);
        svg.selectAll('circle')
          .attr('cx', d=>d.x=Math.max(12, Math.min(width-12, d.x)))
          .attr('cy', d=>d.y=Math.max(12, Math.min(height-12, d.y)));
        label.attr('x', d=>d.x+8).attr('y', d=>d.y+3);
      }
      function dragstarted(event, d){ if (!event.active) simulation.alphaTarget(0.3).restart(); d.fx=d.x; d.fy=d.y; }
      function dragged(event, d){ d.fx=event.x; d.fy=event.y; }
      function dragended(event, d){ if (!event.active) simulation.alphaTarget(0); d.fx=null; d.fy=null; }
      window.addEventListener('resize', ()=>{ /* simple: ignore resize for demo */ });
    }
    /* ---- Populate filter dropdowns ---- */
    function populateDropdowns(){
      const s = DataModule.stats;
      fillOptions(els.organismFilter, Object.keys(s.organism_counts).sort());
      fillOptions(els.areaFilter, Object.keys(s.research_area_counts).sort());
      function fillOptions(select, arr){
        arr.forEach(v=>{
          const opt=document.createElement('option'); opt.value=v; opt.textContent=v; select.appendChild(opt);
        });
      }
    }
    /* ---- Init ---- */
    function init(){
      populateDropdowns();
      bindFilters();
      applyFilters();
      renderPublications(true);
      renderStatsAndCharts();
      renderInsights();
    }
    // Public API
    return {
      init,
      showTab,
      clearFilters,
      loadMore,
      filterByAudience,
      closeAudienceView,
      showJsonModal,
      closeJsonModal
    };
  })();
  // Boot
  window.addEventListener('DOMContentLoaded', app.init);
  </script>
</body>
</html>
