<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTUverse Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ“</text></svg>">
    <style>
        :root {
            --primary: #3b82f6;
            --secondary: #10b981;
            --danger: #ef4444;
            --dark: #0f172a;
            --medium: #475569;
            --light: #f8fafc;
            --white: #ffffff;
            --border: #e2e8f0;
            --gradient-hero: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --gradient-gold: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.12);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        body.dark-mode {
            --light: #0f172a;
            --white: #1e293b;
            --dark: #f1f5f9;
            --medium: #cbd5e1;
            --border: #334155;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-shape {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.1;
        }

        .bg-shape:nth-child(1) {
            width: 600px;
            height: 600px;
            background: var(--gradient-hero);
            top: -300px;
            right: -300px;
            animation: float 25s ease-in-out infinite;
        }

        .bg-shape:nth-child(2) {
            width: 500px;
            height: 500px;
            background: var(--gradient-gold);
            bottom: -250px;
            left: -250px;
            animation: float 20s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30px, -30px); }
        }

        header {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        body.dark-mode header {
            background: rgba(15, 23, 42, 0.8);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
            padding: 1rem 2rem;
        }

        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
        }

        .nav-actions {
            display: flex;
            gap: 1rem;
        }

        .dark-toggle, .logout-btn {
            padding: 0.7rem 1.5rem;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .dark-toggle {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
        }

        .logout-btn {
            background: var(--gradient-danger);
            color: white;
            display: none;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .login-box {
            max-width: 450px;
            width: 100%;
            background: var(--white);
            padding: 3rem;
            border-radius: 24px;
            box-shadow: var(--shadow-xl);
            border: 2px solid var(--border);
        }

        .login-box h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.2rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 2rem;
            background: var(--gradient-hero);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-container {
            max-width: 1600px;
            margin: 100px auto 2rem;
            padding: 2rem;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .admin-header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            background: var(--gradient-hero);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
        }

        .admin-section {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 24px;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--border);
        }

        .admin-section h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            background: var(--white);
            color: var(--dark);
            font-family: 'Inter', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .submit-btn {
            background: var(--gradient-primary);
            color: white;
            padding: 1.2rem 2rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            width: 100%;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .resource-list {
            list-style: none;
            margin-top: 2rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .resource-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            gap: 1rem;
        }

        .resource-item span {
            flex: 1;
        }

        .delete-btn {
            background: var(--gradient-danger);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--medium);
        }

        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 1200px) {
            .admin-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            nav { padding: 1rem; }
            .admin-container { padding: 1rem; margin-top: 80px; }
            .admin-section { padding: 1.5rem; }
        }
    </style>
</head>
<body>
    <div class="bg-animation">
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
    </div>

    <header>
        <nav>
            <a href="index.html" class="logo">
                <i class="fas fa-graduation-cap"></i> GTUverse Admin
            </a>
            <div class="nav-actions">
                <button class="dark-toggle" onclick="toggleDarkMode()">
                    <i class="fas fa-moon" id="darkIcon"></i>
                </button>
                <button class="logout-btn" id="logoutBtn" onclick="signOut()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </nav>
    </header>

    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h2>Admin Portal</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="submit-btn" id="loginBtn">
                    Access Dashboard
                </button>
            </form>
        </div>
    </div>

    <div class="admin-container" id="adminContainer" style="display: none;">
        <div class="admin-header">
            <h1>Admin Dashboard</h1>
            <p>Manage all GTUverse content</p>
        </div>

        <div class="admin-grid">
            <!-- Activities Section -->
            <div class="admin-section">
                <h2><i class="fas fa-trophy"></i> 100 Points Activities</h2>
                <form id="activityForm">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="actTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="actDesc" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Points</label>
                        <input type="number" id="actPoints" min="1" max="100" required>
                    </div>
                    <div class="form-group">
                        <label>Duration</label>
                        <input type="text" id="actDuration" placeholder="e.g., 2-3 hours" required>
                    </div>
                    <div class="form-group">
                        <label>Icon Class</label>
                        <input type="text" id="actIcon" placeholder="fas fa-briefcase" required>
                    </div>
                    <div class="form-group">
                        <label>Link</label>
                        <input type="url" id="actLink" required>
                    </div>
                    <button type="submit" class="submit-btn">Add Activity</button>
                </form>
                <ul class="resource-list" id="activityList"></ul>
            </div>

            <!-- Papers Section -->
            <div class="admin-section">
                <h2><i class="fas fa-file-alt"></i> Papers</h2>
                <form id="paperForm">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="paperTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="paperType" required>
                            <option value="midsem">Midsem</option>
                            <option value="gtu">GTU Exam</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Branch</label>
                        <select id="paperBranch" required>
                            <option value="CE">Computer Engineering</option>
                            <option value="IT">Information Technology</option>
                            <option value="ME">Mechanical Engineering</option>
                            <option value="EC">Electronics & Communication</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Semester</label>
                        <input type="number" id="paperSem" min="1" max="8" required>
                    </div>
                    <div class="form-group">
                        <label>College</label>
                        <input type="text" id="paperCollege" required>
                    </div>
                    <div class="form-group">
                        <label>PDF URL</label>
                        <input type="url" id="paperUrl" required>
                    </div>
                    <button type="submit" class="submit-btn">Add Paper</button>
                </form>
                <ul class="resource-list" id="paperList"></ul>
            </div>

            <!-- Books Section -->
            <div class="admin-section">
                <h2><i class="fas fa-book"></i> Books</h2>
                <form id="bookForm">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="bookTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Branch</label>
                        <select id="bookBranch" required>
                            <option value="CE">Computer Engineering</option>
                            <option value="IT">Information Technology</option>
                            <option value="ME">Mechanical Engineering</option>
                            <option value="EC">Electronics & Communication</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Semester</label>
                        <input type="number" id="bookSem" min="1" max="8" required>
                    </div>
                    <div class="form-group">
                        <label>College</label>
                        <input type="text" id="bookCollege" required>
                    </div>
                    <div class="form-group">
                        <label>PDF URL</label>
                        <input type="url" id="bookUrl" required>
                    </div>
                    <button type="submit" class="submit-btn">Add Book</button>
                </form>
                <ul class="resource-list" id="bookList"></ul>
            </div>

            <!-- Announcements Section -->
            <div class="admin-section">
                <h2><i class="fas fa-bullhorn"></i> Announcements</h2>
                <form id="annForm">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="annTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="annDesc" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="annDate" required>
                    </div>
                    <div class="form-group">
                        <label>Link (Optional)</label>
                        <input type="url" id="annLink">
                    </div>
                    <button type="submit" class="submit-btn">Add Announcement</button>
                </form>
                <ul class="resource-list" id="annList"></ul>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut as fbSignOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const app = initializeApp({
            apiKey: "AIzaSyC0QTiJoEIkS7rGDFrd057Kx3nMz7_s2EI",
            authDomain: "gtu-verse.firebaseapp.com",
            projectId: "gtu-verse",
            storageBucket: "gtu-verse.firebasestorage.app",
            messagingSenderId: "99377635087",
            appId: "1:99377635087:web:05ba93798e36040cfe287a"
        });

        const auth = getAuth(app);
        const db = getFirestore(app);

        window.toggleDarkMode = () => {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('darkIcon');
            icon.className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        };

        if (localStorage.getItem('darkMode') === 'true') toggleDarkMode();

        function setBtnLoading(btn, loading) {
            if (loading) {
                btn.disabled = true;
                btn.innerHTML = '<span class="loading"></span>';
            } else {
                btn.disabled = false;
                btn.innerHTML = btn.dataset.text || 'Submit';
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            btn.dataset.text = 'Access Dashboard';
            setBtnLoading(btn, true);
            try {
                await signInWithEmailAndPassword(auth, 
                    document.getElementById('email').value,
                    document.getElementById('password').value
                );
            } catch (error) {
                alert('Login failed: ' + error.message);
                setBtnLoading(btn, false);
            }
        });

        window.signOut = async () => {
            if (confirm('Logout?')) {
                try {
                    await fbSignOut(auth);
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        };

        async function loadAll() {
            // Load Activities
            const acts = await getDocs(query(collection(db, 'activities'), orderBy('createdAt', 'desc')));
            document.getElementById('activityList').innerHTML = acts.empty 
                ? '<li class="empty-state">No activities</li>'
                : acts.docs.map(d => `
                    <li class="resource-item">
                        <span><strong>${d.data().title}</strong> (${d.data().points} pts)</span>
                        <button class="delete-btn" onclick="deleteItem('activities','${d.id}')">Delete</button>
                    </li>
                `).join('');

            // Load Papers
            const papers = await getDocs(query(collection(db, 'papers'), orderBy('createdAt', 'desc')));
            document.getElementById('paperList').innerHTML = papers.empty 
                ? '<li class="empty-state">No papers</li>'
                : papers.docs.map(d => `
                    <li class="resource-item">
                        <span><strong>${d.data().title}</strong> (${d.data().branch} Sem ${d.data().sem})</span>
                        <button class="delete-btn" onclick="deleteItem('papers','${d.id}')">Delete</button>
                    </li>
                `).join('');

            // Load Books
            const books = await getDocs(query(collection(db, 'books'), orderBy('createdAt', 'desc')));
            document.getElementById('bookList').innerHTML = books.empty 
                ? '<li class="empty-state">No books</li>'
                : books.docs.map(d => `
                    <li class="resource-item">
                        <span><strong>${d.data().title}</strong> (${d.data().branch} Sem ${d.data().sem})</span>
                        <button class="delete-btn" onclick="deleteItem('books','${d.id}')">Delete</button>
                    </li>
                `).join('');

            // Load Announcements
            const anns = await getDocs(query(collection(db, 'announcements'), orderBy('createdAt', 'desc')));
            document.getElementById('annList').innerHTML = anns.empty 
                ? '<li class="empty-state">No announcements</li>'
                : anns.docs.map(d => `
                    <li class="resource-item">
                        <span><strong>${d.data().title}</strong> (${d.data().date})</span>
                        <button class="delete-btn" onclick="deleteItem('announcements','${d.id}')">Delete</button>
                    </li>
                `).join('');
        }

        document.getElementById('activityForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('.submit-btn');
            btn.dataset.text = 'Add Activity';
            setBtnLoading(btn, true);
            try {
                await addDoc(collection(db, 'activities'), {
                    title: document.getElementById('actTitle').value,
                    description: document.getElementById('actDesc').value,
                    points: parseInt(document.getElementById('actPoints').value),
                    duration: document.getElementById('actDuration').value,
                    icon: document.getElementById('actIcon').value,
                    link: document.getElementById('actLink').value,
                    createdAt: new Date()
                });
                alert('Activity added!');
                e.target.reset();
                loadAll();
            } catch (error) {
                alert('Error: ' + error.message);
            }
            setBtnLoading(btn, false);
        });

        document.getElementById('paperForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('.submit-btn');
            btn.dataset.text = 'Add Paper';
            setBtnLoading(btn, true);
            try {
                await addDoc(collection(db, 'papers'), {
                    title: document.getElementById('paperTitle').value,
                    type: document.getElementById('paperType').value,
                    branch: document.getElementById('paperBranch').value,
                    sem: parseInt(document.getElementById('paperSem').value),
                    college: document.getElementById('paperCollege').value,
                    url: document.getElementById('paperUrl').value,
                    createdAt: new Date()
                });
                alert('Paper added!');
                e.target.reset();
                loadAll();
            } catch (error) {
                alert('Error: ' + error.message);
            }
            setBtnLoading(btn, false);
        });

        document.getElementById('bookForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('.submit-btn');
            btn.dataset.text = 'Add Book';
            setBtnLoading(btn, true);
            try {
                await addDoc(collection(db, 'books'), {
                    title: document.getElementById('bookTitle').value,
                    branch: document.getElementById('bookBranch').value,
                    sem: parseInt(document.getElementById('bookSem').value),
                    college: document.getElementById('bookCollege').value,
                    url: document.getElementById('bookUrl').value,
                    createdAt: new Date()
                });
                alert('Book added!');
                e.target.reset();
                loadAll();
            } catch (error) {
                alert('Error: ' + error.message);
            }
            setBtnLoading(btn, false);
        });

        document.getElementById('annForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('.submit-btn');
            btn.dataset.text = 'Add Announcement';
            setBtnLoading(btn, true);
            try {
                await addDoc(collection(db, 'announcements'), {
                    title: document.getElementById('annTitle').value,
                    desc: document.getElementById('annDesc').value,
                    date: document.getElementById('annDate').value,
                    link: document.getElementById('annLink').value || null,
                    createdAt: new Date()
                });
                alert('Announcement added!');
                e.target.reset();
                loadAll();
            } catch (error) {
                alert('Error: ' + error.message);
            }
            setBtnLoading(btn, false);
        });

        window.deleteItem = async (coll, id) => {
            if (confirm('Delete this item?')) {
                try {
                    await deleteDoc(doc(db, coll, id));
                    alert('Deleted!');
                    loadAll();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        };

        auth.onAuthStateChanged(user => {
            const authorized = ['dax@gtuverse.com', 'simran@gtuverse.com', 'prachipp@gtuverse.com'];
            if (user && authorized.includes(user.email)) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContainer').style.display = 'block';
                document.getElementById('logoutBtn').style.display = 'block';
                loadAll();
            } else {
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('adminContainer').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'none';
                if (user && !authorized.includes(user.email)) {
                    alert('Access denied!');
                    fbSignOut(auth);
                }
            }
        });
    </script>
</body>
</html>
